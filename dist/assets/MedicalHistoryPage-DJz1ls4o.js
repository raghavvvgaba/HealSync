import{f as k,r as a,j as e,U as R,A as F,H as N,C as D,z as C,y as L,V as E}from"./vendor-B8hWb8lf.js";import{u as S,b as A}from"./index-CTefgPQJ.js";import"./vendor-libs-BUKHmL5v.js";import"./firebase-DrKyEM-o.js";const $=()=>{const y=k(),{user:o}=S(),[c,r]=a.useState([]),[i,g]=a.useState(!0),[d,n]=a.useState(null),[w,j]=a.useState(null),[m,v]=a.useState(!0),[x,b]=a.useState(!1);a.useLayoutEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const s=setTimeout(()=>{window.scrollTo({top:0,left:0,behavior:"auto"}),document.documentElement.scrollTop=0,document.body.scrollTop=0},0);return()=>clearTimeout(s)},[]),a.useEffect(()=>{o!=null&&o.uid&&p(!0)},[o]);const p=async(s=!1)=>{try{s?(g(!0),n(null),r([]),j(null)):b(!0);const t=await A(o.uid,s?null:w,20,!1);if(t.success){const l=t.data||[];r(s?l:f=>[...f,...l]),j(t.lastDoc||null),v(!!t.hasMore)}else n(t.error||"Failed to fetch medical records"),s&&r([])}catch(t){console.error("Error fetching medical records:",t),n("Failed to load medical records"),s&&r([])}finally{g(!1),b(!1)}},T=()=>{!x&&m&&p(!1)},h=()=>{p(!0),window.scrollTo({top:0,left:0,behavior:"auto"})},u=({items:s,colorClass:t})=>e.jsx("div",{className:"flex flex-wrap gap-2",children:s&&s.length>0?s.map((l,f)=>e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${t}`,children:l},f)):e.jsx("span",{className:"text-sm text-gray-500 italic",children:"None specified"})}),M=({record:s})=>{var t,l;return e.jsxs("div",{className:"glass rounded-2xl p-5 sm:p-6 border soft-divider hover-glow-primary",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-lg font-semibold text-text",children:s.diagnosis||"Medical Record"}),e.jsxs("p",{className:"text-xs sm:text-sm text-secondary",children:[s.visitDate?new Date(s.visitDate).toLocaleDateString():"No date specified",(t=s.createdAt)!=null&&t.toDate?` at ${new Date(s.createdAt.toDate()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:""," ","â€¢ ",s.doctorName||((l=s.doctor)==null?void 0:l.name)||"Unknown Doctor"]})]}),s.fileUrl&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:s.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-primary hover:bg-white/10 rounded-lg transition-colors",title:"View file",children:e.jsx(L,{className:"text-sm"})}),e.jsx("a",{href:s.fileUrl,download:!0,className:"p-2 text-primary hover:bg-white/10 rounded-lg transition-colors",title:"Download file",children:e.jsx(E,{className:"text-sm"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text mb-2",children:"Symptoms"}),e.jsx(u,{items:s.symptoms,colorClass:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text mb-2",children:"Medicines"}),e.jsx(u,{items:s.medicines,colorClass:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"})]}),s.prescribedTests&&s.prescribedTests.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-text mb-2",children:"Prescribed Tests"}),e.jsx(u,{items:s.prescribedTests,colorClass:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"})]}),s.followUpNotes&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm font-medium text-text mb-2",children:"Follow-up Notes"}),e.jsx("p",{className:"text-sm text-secondary glass p-3 rounded-lg border soft-divider",children:s.followUpNotes})]})]})]})};return e.jsx("div",{className:"min-h-screen bg-background aurora-bg text-text px-3 sm:px-6 py-6",children:e.jsxs("div",{ref:s=>{s&&console.log("MedicalHistoryPage scroll position:",window.scrollY,document.documentElement.scrollTop)},children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:[e.jsxs("button",{onClick:()=>y(-1),className:"inline-flex items-center gap-2 glass rounded-full px-3 py-1.5 text-sm text-secondary hover-glow-primary",children:[e.jsx(R,{size:18}),e.jsx("span",{className:"font-medium",children:"Back"})]}),e.jsx("button",{onClick:h,disabled:i,className:"glass rounded-lg border soft-divider px-4 py-2 text-sm text-text hover-glow-primary disabled:opacity-50",title:"Refresh records",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(F,{className:`${i?"animate-spin":""}`}),"Refresh"]})})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-text mb-4",children:"Your Complete Medical History"}),i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"animate-spin text-4xl text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-secondary",children:"Loading your medical records..."})]}),d&&!i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"text-red-400 text-5xl mb-4 mx-auto"}),e.jsx("p",{className:"text-red-500 mb-2 text-lg",children:"Failed to load medical records"}),e.jsx("p",{className:"text-sm text-secondary mb-6",children:d}),e.jsx("button",{onClick:h,className:"glass-cta px-6 py-3",children:"Try Again"})]}),!i&&!d&&e.jsx(e.Fragment,{children:c.length>0?e.jsxs("div",{className:"space-y-4",children:[c.map(s=>e.jsx(M,{record:s},s.id)),m&&e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{onClick:T,disabled:x,className:"px-6 py-2 glass rounded-lg border soft-divider text-text hover-glow-primary disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(N,{className:"animate-spin"}),"Loading..."]}):"Load More Records"})}),e.jsx("div",{className:"text-center mt-4 pt-4 border-t soft-divider",children:e.jsxs("p",{className:"text-sm text-secondary",children:["Showing ",c.length," medical records",!m&&c.length>0&&" (all records loaded)"]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"text-secondary text-6xl mb-6 mx-auto"}),e.jsx("h3",{className:"text-xl font-semibold text-text mb-2",children:"No Medical Records Found"}),e.jsx("p",{className:"text-secondary mb-6",children:"Your medical history will appear here once doctors add records to your profile."}),e.jsx("button",{onClick:h,className:"glass-cta px-6 py-3",children:"Check for New Records"})]})})]})})};export{$ as default};
